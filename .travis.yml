sudo: required

language: node_js

node_js:
  - '6'

services:
  - docker

script:
  - npm test
  - npm run coveralls 
  - docker build -t barracksiot/cli:travis-$TRAVIS_JOB_NUMBER .
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
      docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
      docker push barracksiot/cli:travis-$TRAVIS_JOB_NUMBER;
    fi

deploy:
  - provider: npm
    email: bargenson@gmail.com
    api_key:
      secure: VTrqcB3d0y7jQWb3JuLO2TZTczArGnkOzJsik0vBVv17VB/nZyNkPlGfv1zdIIe5x3hMRwP2V/ual+MMEldLhMnGPI8359XYx6D/NAv+P8MmjwbsVbwo8hRG0ctXlDzHI9ni07zh6UaGsh/XiMEtm1sp1ZSzv8LMjNRetOEvP67SicqGvxD2mZHur30s8Fn0qTleamJddYVluJpvsCLYetobeGEghq+aS3l5A1zbnNDHsV54doyfBRjxMO05Awc8md84i4pZTbAGYFpGRxxkmCW6cyUzgWQnIlKUWSypDslwNRJOCzVIZwaXj8uyrnXCk/Bp0eZiooU5CiMjbLMoF2QMxd94vDyIxju/pYnq+yhMsTTdEHm2ZPZCJxdyMbqc0HscvouPi2va6MYXq3XRtR80kDvlAIWYWMJ8pPuSnlSRFUrk5AtQ6MygJeJxyANc+b45uyHQ1PtfBZd3TLm+PNhEZVFEoe2CAvK6IVaNoac7rMLurM/g/vtjrwbCDFBXvMMEUKuhpiVTyuig0V8lRN8IyEhytFnbMmsdFj0D+/B479fpZYOUAq2lXoJ9CxVn/qaZDYTx8DD7e/mP1xm9xJRcwCPB+RuQqDPkqGdRjXcVhkxzVSCQUHR9fOg2LyI1WHOVoc1gfaYt2kSJZ5seKmvATrp5u++yKPIdvkAR1AU=
    on:
      tags: true
      repo: barracksiot/barracks-cli

notifications:
  slack: YhTdgj0B9xkucKEroPt1Gi8PVWTlW4lEk+Jgz3UvSPbn+gEu+j96UDKYvAN1l9W6tyVompHTiYk+pmdmx5EKGoYQ1h5TjgwB/I6TmlD1dg5z9lh2d/vqDI04zYfitZA8yzyZr0K+lbWwGo+ebAcTUuNMQ2d2XTCq4K/9lQqzzO51R/4qXraTJ1rhMEiQlp9nRAGTj6ld6AfnlC0rv0/vr09dloMuFlc7RvTn0jfHslYcJcM6MfUAdhX4HuvBiw4lF9Tri6cEr24TNFa199GVc20t3Slbza+LYV5+LiOt+Aa5B1Yjd+b1tcdSV0W9rP6JMCjajOPlU7F45f4QxhxyDJbIXcYTY4Nt83sflfWoHOWRVzzDRqymU1x3SfIM6VJmqfhPmyCO4wMFLsndg8jhl6AYL0SCnZicAE3Bde0m98te19fOzRdSmfADs3NS9R+ruKWf885ynsOmWAYJC+Hj6bY/TkU6giVgOURoYFduFzdsC+AYv+XEaXLiiDtXB8qY/jcSc5SwqAQd3+T87562UdaJI87eL8vlUvWbd9IfoMSelUUjfLPOT3w4FQ8IDxtNfCccLGlkb7dHE07xcLNivAYKX03dvXmVPImDRyD6by+nz6blm3hsCmY8VgwaGQa0UxHSa6RsLAKL88KIAac86a+XzZKj+/OVPpKkELnPltw=
    on_success: change
    on_failure: always